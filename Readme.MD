Проект создан в ознакомительных целях, для API запросов на сервер (где будет расположен проект) 
и параллельной работе с PostgreSQL.   
Дополнительно настроенная Grafana служит для ознакомления работы с сервисом 
и при необходимости может дорабатываться (например, добавлением других дашбордов).

***Порядок работы контейнеров:***
- Запускается БД в первом контейнере.
- Запускается приложение во втором контейнере. Тут же запускается автоматически миграция "Alembic". 
При запуске миграции создаются только пустые таблицы приложения.
- Запускается третий контейнер "Redis" - он отвечает за хранение паролей в оперативной памяти.
- Запускаются остальные контейнеры: Grafana (графическое отображение метрик), Prometheus (сборщик информации), 
Node_exporter (передает информацию о сервере в Prometheus), Postgres_exporter (передает информацию о БД в Prometheus).

***Как запустить проект на удаленном сервере (работаем с docker-compose.yaml):***   
- Зайти на свой сервер (для удобства использования на Windows или MacOS можно использовать MobaXterm).  
На данном этапе вы должны иметь логин и пароль для входа на сервер.
- Убедиться, что порты указанные в настройках приложения, не используются сторонними сервисами. 
- Перейти в папку, куда планируете переместить проект.
- Скопировать данную папку проекта в папку на сервере.
- Создать файл ".env" в корне проекта с содержанием (значения необходимо заполнить):  
SECRET_KEY=(формируется в app/auth/secret_key_generator.py)  
APP_HOST_PORT=  
DB_HOST=  
DB_PORT=  
DB_NAME=  
DB_USER=  
DB_PASSWORD=  
DB_URI=postgresql+asyncpg://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}  
DB_EXPORTER_URI=postgresql://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}?sslmode=disable 
GRAFANA_PORT=  
GRAFANA_USER=  
GRAFANA_PASSWORD=  
REDIS_HOST=  
REDIS_PORT=
- В терминале сервера перейти в папку проекта.
- Запустить в терминале команду: docker compose up -d (докер создаст все необходимые контейнеры).
- Если в процессе выполнения прошлой команды, что-то пошло не так, необходимо посмотреть логи контейнеров, 
выполнив команду в терминале сервера: docker compose logs.
- После того как контейнеры успешно запустились необходимо перейти на URL:
http://<IP сервера>:8000/docs#/ (порт подключения можно изменить в файле ".env")
По этому адресу откроется Swagger документация проекта.
- Если документация открылась успешно, открыть страницу с Grafana по адресу:
http://<IP сервера>:3000/. (порт подключения можно изменить в файле ".env")  
При входе потребуется ввести логин и пароль(qa/123), логин и пароль также можно изменить в файле ".env".
После чего откроется не настроенная Grafana. 
- Для настройки Grafana необходимо перейти в "Data sources" и подключить "Prometeus", добавив URL подключения: http://prometheus:9090.  
Далее добавить в "Dashboards" 2 дашборда для мониторинга сервера и мониторинга БД проекта.   
В настройках каждого из дашбордов нужно будет сослаться на созданное ранее подключение Prometeus.

***Дашборды можно использовать эти:***  
1. NodeExporter (https://grafana.com/grafana/dashboards/1860-node-exporter-full/)  
2. PostgreSQL (https://grafana.com/grafana/dashboards/9628-postgresql-database/)

***Команды для работы с docker compose (на случай, если надо что-то остановить, изменить и т.д) (для разработчика):***

1. docker compose down - удаление контейнеров
2. docker-compose logs redis - просмотр логов конкретного контейнера с сервисом, в данном случае "redis"
3. docker-compose restart grafana - перезагрузка конкретного контейнера с сервисом, в данном случае Grapana
4. docker rmi $(docker images -q) - удаляет все образы кроме приявязанных к работающим контейнерам


***Команды по работе с миграциями (для разработчика):***

1. alembic init -t async alembic: инициализирует новую базу данных миграций.
2. alembic revision --autogenerate -m "Описание миграции": создает новую миграцию на основе текущего состояния базы данных.
3. alembic upgrade head: применит все миграции до последней.
4. alembic downgrade base: откатит все миграции до начальной точки.
5. alembic history: показывает историю миграций.
6. alembic current: показывает текущую версию базы данных.
7. alembic heads: показывает последнюю версию базы данных.


***Доступы для работы приложения:***
- Все логины и пароли прописаны в app/users/crud.py, но при необходимости могут быть изменены. 
- **!!! Обрати внимание !!! Не давай пароль ученикам от пользователя "voldemort"). Только этим пользователем можно удалить 
и пересоздать таблицы с тестовыми данными в веб интерфейсе (Swagger)**

===============================================================   
***Для локального запуска (используем Dockerfile):***

- Запускаем БД в контейнере (т.к.п приложение будет работать уже с этой базой) командой:  
docker run --name postgres -p 5433:5432 -e POSTGRES_USER=<логин для БД> -e POSTGRES_PASSWORD=<пароль для БД> -e POSTGRES_DB=<название БД> -d postgres:latest
- В файле ".env" устанавливаем:   
DB_HOST=localhost  # Убедитесь, что это имя сервиса в docker-compose или localhost при локальном запуске  
DB_PORT=5433  # Внешний порт  
DB_NAME=......  # Название вашей базы данных  
DB_USER=......  # Имя пользователя базы данных  
DB_PASSWORD=......  # Пароль вашей базы данных 
REDIS_HOST=localhost  
REDIS_PORT=6379  
- В файле "main.py" раскомментируем все строки (т.к. будем работать без миграций и обычными командами создадим таблицы) 
и запустим этот файл 


